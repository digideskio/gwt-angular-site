<html>
<head>
<script src="node_modules/sql.js/js/sql.js"></script>
<script src="node_modules/angular/angular.min.js"></script>
</head>
<body data-ng-app="myApp">

<div data-ng-controller="DemoController">
  result: {{ result }}
</div>

<div data-ng-controller="SecondController">
  foo: {{ foo }}
</div>

<script>
angular.module('angular-sqlite', [])
  .constant('sqlite', window.SQL)
  .provider('database', ['sqlite', function DatabaseProvider(sqlite) {
    var queries = [];
    this.sql = function (sqlstring) {
      if (sqlstring) {
        queries.push(sqlstring);
      }
      return this;
    };
    this.$get = [function databaseFactory() {
      var database = new sqlite.Database();
      database.run(queries.join(';'));
      return database;
    }];
  }]);

var myApp = angular.module('myApp', ['angular-sqlite']);

myApp.config(['databaseProvider', function (databaseProvider) {
  databaseProvider
    .sql("CREATE TABLE hello (a int, b char)")
    .sql("INSERT INTO hello VALUES (0, 'hello')")
    .sql("INSERT INTO hello VALUES (1, 'world')");
}]);

myApp.controller('DemoController',
  ['$scope', 'database', function ($scope, database) {
  var stmt = database.prepare("SELECT * FROM hello WHERE a=:aval AND b=:bval");
  var result = stmt.getAsObject({':aval' : 1, ':bval' : 'world'});
  console.log(result);
  stmt.free();
  $scope.result = result;
}]);

myApp.controller('SecondController',
  ['$scope', 'database', function ($scope, database) {
  var stmt = database.prepare("SELECT * FROM hello WHERE a=:aval AND b=:bval");
  var result = stmt.getAsObject({':aval' : 1, ':bval' : 'world'});
  console.log(result);
  stmt.free();
  $scope.foo = result;
}]);
</script>
</body>
</html>
