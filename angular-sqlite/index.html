<html>
<head>
<script src="node_modules/sql.js/js/sql.js"></script>
<script src="node_modules/angular/angular.min.js"></script>
</head>
<body data-ng-app="myApp">

<div data-ng-controller="DemoController">
  result: {{ result }}
</div>
<div data-ng-controller="SecondController">
  foo: {{ foo }}
</div>

<script>
var sqlite = angular.module('angular-sqlite', []);
sqlite.provider('database', [function DatabaseProvider() {
  this.$get = [function databaseFactory() {
    return new window.SQL.Database();
  }];
}]);

var myApp = angular.module('myApp', ['angular-sqlite']);
myApp.controller('DemoController',
  ['$scope', 'database', function ($scope, database){
  var sqlstr = "CREATE TABLE hello (a int, b char);";
  sqlstr += "INSERT INTO hello VALUES (0, 'hello');"
  sqlstr += "INSERT INTO hello VALUES (1, 'world');"
  database.run(sqlstr);
  var stmt = database.prepare("SELECT * FROM hello WHERE a=:aval AND b=:bval");
  var result = stmt.getAsObject({':aval' : 1, ':bval' : 'world'});
  console.log(result);
  stmt.free();
  $scope['result'] = result;
}]);

myApp.controller('SecondController',
  ['$scope', 'database', function ($scope, database) {
  
  var stmt = database.prepare("SELECT * FROM hello WHERE a=:aval AND b=:bval");
  var result = stmt.getAsObject({':aval' : 1, ':bval' : 'world'});
  console.log(result);
  stmt.free();
  $scope['foo'] = result;

}]);
</script>
</body>
</html>
