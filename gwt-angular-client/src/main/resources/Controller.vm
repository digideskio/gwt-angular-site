package ${packageName};

import java.util.*;

import com.google.gwt.core.client.*;
import com.asayama.gwt.core.client.*;
import com.asayama.gwt.angular.client.*;

public class ${generatedSimpleName} extends ${simpleName} implements Controller.Constructor {

	${generatedSimpleName}() {
	}
	
	@Override
	public void onControllerLoad() {
		String m = "calling ${qualifiedName}.onControllerLoad";
		GWT.log(m);
		try {
			super.onControllerLoad();
		} catch (Exception e) {
			GWT.log("Exception while " + m, e);
		}
	}
	
	@Override
	public void onInjection(Injectable object) {
		String m = "calling ${qualifiedName}.onInjection";
		GWT.log(m);
		try {
			super.onInjection(object);
		} catch (Exception e) {
			GWT.log("Exception while " + m, e);
		}
	}
	
	@Override
	public <T extends Module> void _injectServices(T module) {
		String m = "";
#foreach($field in $serviceFields)
		try {
			m = "injecting ${field.type.qualifiedSourceName} into ${simpleName}.${field.name}";
			${field.type.qualifiedSourceName} service = GWT.create(${field.type.qualifiedSourceName}.class);
			${field.name} = module.factory("${field.type.qualifiedSourceName}", service);
		} catch (Exception e) {
			GWT.log("Exception while " + m, e);
		}
#end
	}

	@Override
	public $ constructor(Invoker invoker) {
		return _constructor(this, invoker);
	}

	native $ _constructor(${simpleName} itself, Invoker invoker) /*-{
		return [
			'$scope',
#foreach($field in $serviceFields)
			'${field.type.qualifiedSourceName}',
#end
			function ($scope#foreach($field in $serviceFields), ${field.name}#end) {
#foreach($method in $exportMethods)
				$scope.${method.name} = function (#foreach($param in ${method.parameters})#if($foreach.index>0), #end${param.name}#end) {
					return itself.${method.jsniSignature}(#foreach($param in ${method.parameters})#if($foreach.index>0), #end${param.name}?${param.name}:${param.name}==0?0:null#end);
				};
#end
#foreach($field in $serviceFields)
				//itself.@${generatedQualifiedName}::onInjection(Lcom/asayama/gwt/angular/client/Injectable;)(${field.name});
#end
				itself.@${generatedQualifiedName}::onControllerLoad()();
				invoker.@com.asayama.gwt.core.client.Invoker::invoke()();
			}
		];
	}-*/;
	
}